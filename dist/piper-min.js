var piper={version:"0.1.0"};if(piper.utils={pipeline:function(){var e=arguments,t=this;return function(r){for(var n=0;n<e.length;n++){var i=e[n].call(this,r);r=t.mergeAll(r,i)}return r}},override:function(e,t){for(var r in t)r in e&&(e[r]=t[r])},merge:function(e,t){for(var r in t)t[r]&&t[r].constructor==Object&&e[r]?this.merge(e[r],t[r]):e[r]=t[r]},mergeAll:function(){for(var e={},t=arguments,r=0;r<t.length;r++)this.merge(e,t[r]);return e},reactiveProperty:function(e){function t(t){if(1===arguments.length){if(e=t,r)for(var n=0;n<r.length;n++)r[n](e);return this}return e}var r;return t.on=function(t){return r||(r=[]),r.push(t),"undefined"!=typeof e&&null!==e&&t(e),t},t.off=function(e){r&&(r=r.filter(function(t){return t!==e}))},t}},piper.barChartAutoConfig=function(e){return{axisYPadding:20}},piper.data=function(e){var t={data:null};piper.utils.override(t,e);var r=t.data.map(function(e,t){return{x:t,y:e}});return{dataConverted:r}},piper.dataTime=function(e){var t={data:null};piper.utils.override(t,e);var r=t.data.map(function(e,t){return{x:e.timestamp,y:e.value}});return{dataConverted:r}},piper.dataGrouped=function(e){var t={data:null};piper.utils.override(t,e);var r=t.data.map(function(e,t){return{x:t,groupName:e.key,y:e.values.map(function(e,t){return e.value})}}),n=d3.merge(r.map(function(e,t){return e.y}));return{dataConverted:r,dataFlat:n}},piper.scaleX=function(e){var t={dataConverted:null,margin:null,width:null,scaleType:null};piper.utils.override(t,e);var r=t.width-t.margin.left-t.margin.right,n=t.dataConverted.map(function(e){return e.x}),i=d3.scale.linear().domain(d3.extent(n)).range([0,r]);return{scaleX:i,chartWidth:r}},piper.scaleXTime=function(e){var t={dataConverted:null,margin:null,width:null,scaleType:null};piper.utils.override(t,e);var r=t.width-t.margin.left-t.margin.right,n=t.dataConverted.map(function(e){return e.x}),i=d3.time.scale().domain(d3.extent(n)).range([0,r]);return{scaleX:i,chartWidth:r}},piper.scaleY=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var r=t.height-t.margin.top-t.margin.bottom,n=t.dataConverted.map(function(e){return e.y}),i=d3.scale.linear().domain(d3.extent(n)).range([r,0]);return{scaleY:i,chartHeight:r}},piper.scaleYGrouped=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var r=t.height-t.margin.top-t.margin.bottom,n=t.dataConverted.map(function(e){return e.y}),i=d3.scale.linear().domain(d3.extent(d3.merge(n))).range([r,0]);return{scaleY:i,chartHeight:r}},piper.scaleYFrom0=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var r=t.height-t.margin.top-t.margin.bottom,n=t.dataConverted.map(function(e){return e.y}),i=d3.scale.linear().domain([0,d3.max(n)]).range([r,0]);return{scaleY:i,chartHeight:r}},piper.scaleYFrom0Padded=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var r=t.height-t.margin.top-t.margin.bottom,n=t.dataConverted.map(function(e){return e.y}),i=d3.max(n),a=1-(i-d3.min(n))/i,l=i+i*a,p=d3.scale.linear().domain([0,l]).range([r,0]);return{scaleY:p,chartHeight:r}},piper.axisX=function(e){var t={scaleX:null,axisXFormat:"%H:%M",axisXTimeResolution:"minutes",axisXTimeSteps:2};piper.utils.override(t,e);var r=d3.svg.axis().scale(t.scaleX).orient("bottom");return{axisX:r}},piper.axisY=function(e){var t={scaleY:null};piper.utils.override(t,e);var r=t.scaleY.range()[0],n=d3.svg.axis().scale(t.scaleY).orient("left").ticks(Math.max(~~(r/30),2),".s3").tickPadding(10);return{axisY:n}},piper.panelComponent=function(e){var t={container:null,width:null,height:null,margin:null};piper.utils.override(t,e);var r=d3.select(t.container).selectAll("svg").data([0]);r.enter().append("svg").attr({"class":"piper-chart"}).append("g").attr({"class":"panel"}),r.attr({width:t.width,height:t.height}),r.exit().remove();var n=r.select("g.panel").attr({transform:"translate("+t.margin.left+","+t.margin.top+")"});return{root:r,panel:n}},piper.axisComponentX=function(e){var t={axisX:null,chartHeight:null,panel:null};piper.utils.override(t,e);var r=t.panel.selectAll("g.axis.x").data([0]);return r.enter().append("g").attr({"class":"x axis",transform:"translate("+[0,t.chartHeight]+")"}),r.transition().attr({transform:"translate("+[0,t.chartHeight]+")"}).call(t.axisX),r.exit().remove(),{}},piper.singleAxisComponentX=function(e){var t={axisX:null,panel:null};piper.utils.override(t,e);var r=t.panel.selectAll("g.axis.x.single").data([0]);return r.enter().append("g").attr({"class":"x axis single"}),r.transition().call(t.axisX),r.exit().remove(),{}},piper.axisComponentY=function(e){var t={axisY:null,panel:null,axisYPadding:null};piper.utils.override(t,e);var r=t.axisYPadding||0,n=t.panel.selectAll("g.axis.y").data([0]);return n.enter().append("g").attr({"class":"y axis",transform:"translate("+[-r/2,0]+")"}),n.transition().call(t.axisY),n.exit().remove(),{}},piper.axisTitleComponentX=function(e){var t={panel:null,axisTitleX:null,chartHeight:null,chartWidth:null};piper.utils.override(t,e);var r=t.panel.selectAll("text.axis-title.x").data([0]);return r.enter().append("text").attr({"class":"x axis-title"}),r.text(t.axisTitleX||"").attr({x:t.chartWidth,y:t.chartHeight}),r.exit().remove(),{}},piper.axisTitleComponentY=function(e){var t={panel:null,axisTitleY:null};piper.utils.override(t,e);var r=t.panel.selectAll("text.axis-title.y").data([0]);return r.enter().append("text").attr({"class":"y axis-title"}),r.text(t.axisTitleY||"").attr({x:-40,y:-10}),r.exit().remove(),{}},piper.chartTitleComponent=function(e){var t={panel:null,chartTitle:null,chartWidth:null};piper.utils.override(t,e);var r=t.panel.selectAll("text.chart-title").data([0]);return r.enter().append("text").attr({"class":"chart-title"}),r.text(t.chartTitle||"").attr({x:function(e){return(t.chartWidth-5*t.chartTitle.length)/2},y:-5}),r.exit().remove(),{}},piper.tooltipWidget=function(e){var t=d3.select(e).style({position:"absolute","pointer-events":"none",display:"none"}),r=function(e){return t.html(e),this},n=function(e){return t.style({left:e[0]+"px",top:e[1]+"px"}),this},i=function(){return t.style({display:"block"}),this},a=function(){return t.style({display:"none"}),this},l=function(){return t.node()};return{setText:r,setPosition:n,show:i,hide:a,getRootNode:l}},piper.thresholdLine=function(e){var t={panel:null,scaleY:null,margin:null,chartWidth:null,thresholdY:null};if(piper.utils.override(t,e),"number"!=typeof t.thresholdY)return{};var r=t.scaleY(t.thresholdY),n="M"+[[0,r],[t.chartWidth+6,r]].join("L"),i=t.panel.selectAll("path.threshold").data([0]);return i.enter().append("path").attr({"class":"threshold shape"}).style({fill:"none"}),i.attr({d:n}),i.exit().remove(),{}},piper.thresholdLineLabel=function(e){var t={panel:null,scaleY:null,margin:null,chartWidth:null,thresholdY:null,thresholdYLabel:null};if(piper.utils.override(t,e),!t.thresholdYLabel)return{};var r=t.scaleY(t.thresholdY),n=("M"+[[0,r],[t.chartWidth+6,r]].join("L"),t.panel.selectAll("text.threshold-label").data([0]));return n.enter().append("text").attr({"class":"threshold-label",x:t.chartWidth+8,y:r+2}),n.text(t.thresholdYLabel),n.exit().remove(),{}},piper.verticalLine=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,chartHeight:null,margin:null,verticalLineX:null,verticalLineValue:null};piper.utils.override(t,e);var r=t.scaleX(t.verticalLineX),n="M"+[[r,0],[r,t.chartHeight]].join("L"),i=t.panel.selectAll("path.vertical-line").data([0]);i.enter().append("path").attr({"class":"vertical-line shape"}),i.attr({d:n}),i.exit().remove();var a=t.panel.selectAll("text.vertical-line-label").data([0]);return a.enter().append("text").attr({"class":"vertical-line-label"}),a.attr({x:r+2,y:t.chartHeight+t.margin.top+t.margin.bottom/4}).text(t.verticalLineValue),i.exit().remove(),{}},piper.HTMLTooltip=function(e){var t={container:null,panel:null,dataConverted:null,scaleX:null,scaleY:null,eventPanel:null,mousemove:null,mouseenter:null,mouseout:null,chartWidth:null,chartHeight:null};piper.utils.override(t,e),t.mousemove||piper.utils.override(t,piper.hoverEvents(t));var r=d3.select(t.container).selectAll("div.tooltip").data([0]);r.enter().append("div").classed("tooltip",!0);var n=piper.tooltipWidget(r.node());return t.mousemove.on(function(e){var t=e.shapePositionFromContainer2;n.setPosition([t[0],t[1]]).setText(e.data.y)}),t.mouseenter.on(function(e){n.show()}),t.mouseout.on(function(e){n.hide()}),{}},piper.hoverCircle=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,eventPanel:null,mousemove:null,mouseenter:null,mouseout:null,chartWidth:null,chartHeight:null};piper.utils.override(t,e),t.mousemove||piper.utils.override(t,piper.hoverEvents(t));var r=function(e){var t=d3.select(e).attr({r:4}).style({"pointer-events":"none",display:"none"}),r=function(e){return t.attr({transform:"translate("+e+")"}),this},n=function(){return t.style({display:"block"}),this},i=function(){return t.style({display:"none"}),this};return{setPosition:r,show:n,hide:i}},n=t.panel.selectAll("circle.hover").data([0]);n.enter().append("circle").classed("hover",!0);var i=r(n.node());return t.mousemove.on(function(e){i.setPosition(e.shapePosition)}),t.mouseenter.on(function(e){i.show()}),t.mouseout.on(function(e){i.hide()}),{}},piper.shapePanel=function(e){var t={panel:null};piper.utils.override(t,e);var r=t.panel.selectAll("g.shapes").data([0]);return r.enter().append("g").attr({"class":"shapes"}),r.exit().remove(),{shapePanel:r}},piper.areaShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var n=d3.svg.area().defined(function(e){return null!=e.y}).x(function(e){return t.scaleX(e.x)}).y(function(e){return t.scaleY(e.y)}).y0(t.scaleY.range()[0]),i=t.shapePanel.selectAll("path.line").data([t.dataConverted]);return i.enter().append("path").attr({"class":"line shape"}),i.attr({d:n}),i.exit().remove(),{}},piper.lineShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var n=d3.svg.line().defined(function(e){return null!=e.y}).x(function(e){return t.scaleX(e.x)}).y(function(e){return t.scaleY(e.y)}),i=t.shapePanel.selectAll("path.line").data([t.dataConverted]);return i.enter().append("path").attr({"class":"line shape"}).style({fill:"none"}),i.attr({d:n}),i.exit().remove(),{}},piper.barShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,chartHeight:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var n=t.scaleX.range(),i=n[1]-n[0],a=i/(t.dataConverted.length-1)/2,l=t.shapePanel.selectAll("rect.bar").data(t.dataConverted);return l.enter().append("rect").attr({"class":"bar shape"}),l.transition().attr({x:function(e){return t.scaleX(e.x)-a/2},y:function(e){var r=t.scaleY(e.y);return e.barY=e.y>0&&r===t.chartHeight?t.chartHeight-1:r,e.barY},width:function(e){return a},height:function(e){return t.chartHeight-e.barY}}),l.exit().remove(),{}},piper.barShapesGrouped=function(e){var t={panel:null,dataConverted:null,dataFlat:null,scaleX:null,scaleY:null,chartHeight:null,chartWidth:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var n=t.chartWidth/(t.dataFlat.length-1)/2,i=t.chartWidth/(t.dataConverted.length-1),a=t.shapePanel.selectAll("g.shape-group").data(t.dataConverted);a.enter().append("g").attr({"class":"shape-group"}),a.attr({transform:function(e,t){return"translate("+(i*t-i/4)+" 0)"}}),a.exit().remove();var l=a.selectAll("rect.bar").data(function(e){return e.y});return l.enter().append("rect").attr({"class":"bar shape"}),l.transition().attr({x:function(e,t){return n*t},y:function(e){var r=t.scaleY(e);return r=e&&e>0&&r===t.chartHeight?t.chartHeight-1:r},width:function(e){return n},height:function(e){var r=t.scaleY(e);return r=e&&e>0&&r===t.chartHeight?t.chartHeight-1:r,t.chartHeight-r}}),l.exit().remove(),{}},piper.endCircle=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,width:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var n=t.dataConverted[t.dataConverted.length-1],i=t.shapePanel.selectAll("circle.end-circle").data([n]);return i.enter().append("circle").attr({"class":"end-circle shape"}),i.attr({cx:function(e){return t.scaleX(e.x)},cy:function(e){return t.scaleY(e.y)},r:2}),i.exit().remove(),{}},piper.eventCatchingLayer=function(e){var t={panel:null,chartWidth:null,chartHeight:null};piper.utils.override(t,e);var r=(d3.dispatch("mousemove"),t.panel.selectAll("g.event-panel-container").data([0]));r.enter().append("g").attr({"class":"event-panel-container"}).append("rect").attr({"class":"event-panel"}),r.exit().remove();var n=r.select(".event-panel").attr({width:t.chartWidth,height:t.chartHeight}).style({visibility:"hidden","pointer-events":"all"});return{eventPanel:n}},piper.events=function(e){var t={eventer:null,dispatch:null};return piper.utils.override(t,e),t.eventer&&d3.rebind(t.eventer,t.dispatch,"on"),{}},piper.hoverEvents=function(e){var t={container:null,panel:null,dataConverted:null,scaleX:null,scaleY:null,chartWidth:null,chartHeight:null,eventPanel:null};piper.utils.override(t,e),piper.utils.override(t,piper.eventCatchingLayer(t));var r=piper.utils.reactiveProperty(),n=piper.utils.reactiveProperty(),i=piper.utils.reactiveProperty(),a=t.dataConverted.map(function(e){return e.x}),l=t.scaleX(a[1])-t.scaleX(a[0]);return t.eventPanel.on("mouseenter",function(e){n({mouse:d3.mouse(this)})}).on("mouseout",function(e){i({mouse:d3.mouse(this)})}).on("mousemove",function(e,n){var i=d3.mouse(this),p=d3.mouse(t.container),o=this.getBoundingClientRect(),s=t.container.getBoundingClientRect(),u=s.left,c=s.top,d=t.scaleX.invert(i[0]-l/2),h=d3.bisectLeft(a,d),v=t.dataConverted[h];if(v)var m=v.x,x=v.y,f=t.scaleX(m),g=t.scaleY(x);r({data:v,mouse:i,mouseFromContainer:[p[0]+u+window.pageXOffset,p[1]+c+window.pageYOffset],shapePosition:[f,g],shapePositionFromContainer:[f+o.left,g+o.top+window.pageYOffset],shapePositionFromContainer2:[f+o.left-s.left,g+o.top-s.top]})}),{mousemove:r,mouseenter:n,mouseout:i}},piper.tooltipComponent=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,eventPanel:null,chartWidth:null,chartHeight:null,dispatch:null,eventer:null};piper.utils.override(t,e);var r=piper.eventCatchingLayer(t);piper.utils.override(t,r),r=piper.events(t),piper.utils.override(t,r);var n=t.dataConverted.map(function(e){return e.x}),i=t.scaleX(n[1])-t.scaleX(n[0]),a=t.panel.selectAll("g.tooltip-container").data([0]);a.enter().append("g").attr({"class":"tooltip-container","pointer-events":"none"}).style({visibility:"hidden"}).append("circle").attr({"class":"tooltip-circle",r:3}),a.exit().remove();var l=t.panel.selectAll("g.value-container").data([0]);l.enter().append("g").attr({"class":"value-container","pointer-events":"none"}).style({visibility:"hidden"}).append("text").attr({"class":"value-label",dx:2,dy:-4}),l.exit().remove();var p=t.panel.selectAll("g.line-container").data([0]);p.enter().append("g").attr({"class":"line-container","pointer-events":"none"}).style({visibility:"hidden"}).append("line").attr({"class":"tooltip-line"}),p.exit().remove();var o=l.select(".value-label"),s=(a.select(".tooltip-circle"),p.select(".tooltip-line"));return t.eventPanel.on("mouseenter",function(e){a.style({visibility:"visible"}),l.style({visibility:"visible"}),s.style({visibility:"visible"})}).on("mouseout",function(e){a.style({visibility:"hidden"}),l.style({visibility:"hidden"}),s.style({visibility:"hidden"})}).on("mousemove",function(e,r){var p=d3.mouse(this),u=t.scaleX.invert(p[0]-i/2),c=d3.bisectLeft(n,u),d=t.dataConverted[c];if(d){var h=d.x,v=d.y,m=t.scaleX(h),x=t.scaleY(v);a.attr({transform:"translate("+[m,x]+")"}),l.attr({transform:"translate("+[0,x]+")"}),o.text(v),s.attr({x1:0,y1:x,x2:m,y2:x})}t.dispatch.mousemove(d)}),{}},piper.axisXFormatterTime=function(e){var t={panel:null,dataConverted:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").text(function(e){return d3.time.format("%a")(e)}),{}},piper.axisXFormatterTimeHour=function(e){var t={panel:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").text(function(e){return d3.time.format("%x")(e)}),{}},piper.axisXFormatterRotate30=function(e){var t={panel:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").style({transform:"rotate(30deg)","text-anchor":"start"}),{}},piper.axisYFormatSI=function(e){var t={axisY:null};return piper.utils.override(t,e),t.axisY.tickFormat(function(e){var t=d3.formatPrefix(e),r=t.scale(e).toFixed();return r+t.symbol}),{}},piper.areaChart=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.axisYFormatSI,piper.panelComponent,piper.areaShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.chartTitleComponent,piper.tooltipComponent),piper.areaChartTime=piper.utils.pipeline(piper.dataTime,piper.scaleXTime,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.areaShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.axisXFormatterTimeHour,piper.tooltipComponent),piper.areaChartTimeRotated=piper.utils.pipeline(piper.dataTime,piper.scaleXTime,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.areaShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.chartTitleComponent,piper.axisXFormatterTimeHour,piper.axisXFormatterRotate30,piper.hoverEvents,piper.HTMLTooltip,piper.hoverCircle),piper.areaChartFrom0=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleYFrom0Padded,piper.axisX,piper.axisY,piper.panelComponent,piper.areaShapes,piper.axisComponentY,piper.thresholdLine,piper.thresholdLineLabel,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.chartTitleComponent,piper.tooltipComponent),piper.lineChart=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.lineShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.tooltipComponent),piper.sparkline=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.panelComponent,piper.lineShapes,piper.endCircle,piper.tooltipComponent),piper.barChart=piper.utils.pipeline(piper.data,piper.barChartAutoConfig,piper.scaleX,piper.scaleYStartAt0,piper.axisX,piper.axisY,piper.panelComponent,piper.barShapes,piper.axisComponentY,piper.axisComponentX),piper.barChartPrumo=piper.utils.pipeline(piper.data,piper.barChartAutoConfig,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.barShapes,piper.axisComponentY,piper.thresholdLine,piper.thresholdLineLabel,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.chartTitleComponent,piper.tooltipComponent),piper.barChartGroupedPrumo=piper.utils.pipeline(piper.dataGrouped,piper.barChartAutoConfig,piper.scaleX,piper.scaleYGrouped,piper.axisX,piper.axisY,piper.panelComponent,piper.barShapesGrouped,piper.axisComponentX,piper.axisComponentY,piper.thresholdLine,piper.thresholdLineLabel,piper.axisTitleComponentY,piper.chartTitleComponent,piper.hoverEvents),piper.singleAxis=piper.utils.pipeline(piper.data,piper.scaleX,piper.axisX,piper.panelComponent,piper.singleAxisComponentX),"object"==typeof module&&module.exports){var d3=require("d3");module.exports=piper}