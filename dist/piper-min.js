var piper={version:"0.1.0"};if(piper.utils={pipeline:function(){var e=arguments,t=this;return function(r){for(var a=0;a<e.length;a++){var i=e[a].call(this,r);r=t.mergeAll(r,i)}}},override:function(e,t){for(var r in t)r in e&&(e[r]=t[r])},merge:function(e,t){for(var r in t)t[r]&&t[r].constructor==Object&&e[r]?this.merge(e[r],t[r]):e[r]=t[r]},mergeAll:function(){for(var e={},t=arguments,r=0;r<t.length;r++)this.merge(e,t[r]);return e}},piper.barChartAutoConfig=function(e){return{axisYPadding:20}},piper.data=function(e){var t={data:null};piper.utils.override(t,e);var r=t.data.map(function(e,t){return{x:t,y:e}});return{dataConverted:r}},piper.dataTime=function(e){var t={data:null};piper.utils.override(t,e);var r=t.data.map(function(e,t){return{x:e.timestamp,y:e.value}});return{dataConverted:r}},piper.dataGrouped=function(e){var t={data:null};piper.utils.override(t,e);var r=t.data.map(function(e,t){return{x:t,groupName:e.key,y:e.values.map(function(e,t){return e.value})}}),a=d3.merge(r.map(function(e,t){return e.y}));return{dataConverted:r,dataFlat:a}},piper.scaleX=function(e){var t={dataConverted:null,margin:null,width:null,scaleType:null};piper.utils.override(t,e);var r=t.width-t.margin.left-t.margin.right,a=t.dataConverted.map(function(e){return e.x}),i=d3.scale.linear().domain(d3.extent(a)).range([0,r]);return{scaleX:i,chartWidth:r}},piper.scaleXTime=function(e){var t={dataConverted:null,margin:null,width:null,scaleType:null};piper.utils.override(t,e);var r=t.width-t.margin.left-t.margin.right,a=t.dataConverted.map(function(e){return e.x}),i=d3.time.scale().domain(d3.extent(a)).range([0,r]);return{scaleX:i,chartWidth:r}},piper.scaleY=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var r=t.height-t.margin.top-t.margin.bottom,a=t.dataConverted.map(function(e){return e.y}),i=d3.scale.linear().domain(d3.extent(a)).range([r,0]);return{scaleY:i,chartHeight:r}},piper.scaleYGrouped=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var r=t.height-t.margin.top-t.margin.bottom,a=t.dataConverted.map(function(e){return e.y}),i=d3.scale.linear().domain(d3.extent(d3.merge(a))).range([r,0]);return{scaleY:i,chartHeight:r}},piper.scaleYFrom0=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var r=t.height-t.margin.top-t.margin.bottom,a=t.dataConverted.map(function(e){return e.y}),i=d3.scale.linear().domain([0,d3.max(a)]).range([r,0]);return{scaleY:i,chartHeight:r}},piper.scaleYFrom0Padded=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var r=t.height-t.margin.top-t.margin.bottom,a=t.dataConverted.map(function(e){return e.y}),i=d3.max(a),n=1-(i-d3.min(a))/i,l=i+i*n,p=d3.scale.linear().domain([0,l]).range([r,0]);return{scaleY:p,chartHeight:r}},piper.axisX=function(e){var t={scaleX:null,axisXFormat:"%H:%M",axisXTimeResolution:"minutes",axisXTimeSteps:2};piper.utils.override(t,e);var r=d3.svg.axis().scale(t.scaleX).orient("bottom");return{axisX:r}},piper.axisY=function(e){var t={scaleY:null};piper.utils.override(t,e);var r=t.scaleY.range()[0],a=d3.svg.axis().scale(t.scaleY).orient("left").ticks(Math.max(~~(r/30),2),".s3").tickPadding(10);return{axisY:a}},piper.panelComponent=function(e){var t={container:null,width:null,height:null,margin:null};piper.utils.override(t,e);var r=d3.select(t.container).selectAll("svg").data([0]);r.enter().append("svg").attr({"class":"piper-chart"}).append("g").attr({"class":"panel"}),r.attr({width:t.width,height:t.height}),r.exit().remove();var a=r.select("g.panel").attr({transform:"translate("+t.margin.left+","+t.margin.top+")"});return{root:r,panel:a}},piper.axisComponentX=function(e){var t={axisX:null,chartHeight:null,panel:null};piper.utils.override(t,e);var r=t.panel.selectAll("g.axis.x").data([0]);return r.enter().append("g").attr({"class":"x axis",transform:"translate("+[0,t.chartHeight]+")"}),r.transition().attr({transform:"translate("+[0,t.chartHeight]+")"}).call(t.axisX),r.exit().remove(),{}},piper.singleAxisComponentX=function(e){var t={axisX:null,panel:null};piper.utils.override(t,e);var r=t.panel.selectAll("g.axis.x.single").data([0]);return r.enter().append("g").attr({"class":"x axis single"}),r.transition().call(t.axisX),r.exit().remove(),{}},piper.axisComponentY=function(e){var t={axisY:null,panel:null,axisYPadding:null};piper.utils.override(t,e);var r=t.axisYPadding||0,a=t.panel.selectAll("g.axis.y").data([0]);return a.enter().append("g").attr({"class":"y axis",transform:"translate("+[-r/2,0]+")"}),a.transition().call(t.axisY),a.exit().remove(),{}},piper.axisTitleComponentX=function(e){var t={panel:null,axisTitleX:null,chartHeight:null,chartWidth:null};piper.utils.override(t,e);var r=t.panel.selectAll("text.axis-title.x").data([0]);return r.enter().append("text").attr({"class":"x axis-title"}),r.text(t.axisTitleX||"").attr({x:t.chartWidth-40,y:t.chartHeight+35}),r.exit().remove(),{}},piper.axisTitleComponentY=function(e){var t={panel:null,axisTitleY:null};piper.utils.override(t,e);var r=t.panel.selectAll("text.axis-title.y").data([0]);return r.enter().append("text").attr({"class":"y axis-title"}),r.text(t.axisTitleY||"").attr({x:-40,y:-10}),r.exit().remove(),{}},piper.chartTitleComponent=function(e){var t={panel:null,chartTitle:null,chartHeight:null,chartWidth:null};piper.utils.override(t,e);var r=t.panel.selectAll("text.chart-title").data([0]);return r.enter().append("text").attr({"class":"chart-title"}),r.text(t.chartTitle||"").attr({x:function(e){return(t.chartWidth-this.getBBox().width)/2},y:-5}),r.exit().remove(),{}},piper.thresholdLine=function(e){var t={panel:null,scaleY:null,margin:null,chartWidth:null,thresholdY:null};if(piper.utils.override(t,e),"number"!=typeof t.thresholdY)return{};var r=t.scaleY(t.thresholdY),a="M"+[[0,r],[t.chartWidth+6,r]].join("L"),i=t.panel.selectAll("path.threshold").data([0]);return i.enter().append("path").attr({"class":"threshold shape"}).style({fill:"none"}),i.attr({d:a}),i.exit().remove(),{}},piper.thresholdLineLabel=function(e){var t={panel:null,scaleY:null,margin:null,chartWidth:null,thresholdY:null,thresholdYLabel:null};if(piper.utils.override(t,e),!t.thresholdYLabel)return{};var r=t.scaleY(t.thresholdY),a=("M"+[[0,r],[t.chartWidth+6,r]].join("L"),t.panel.selectAll("text.threshold-label").data([0]));return a.enter().append("text").attr({"class":"threshold-label",x:t.chartWidth+8,y:r+2}),a.text(t.thresholdYLabel),a.exit().remove(),{}},piper.verticalLine=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,chartHeight:null,margin:null,verticalLineX:null,verticalLineValue:null};piper.utils.override(t,e);var r=t.scaleX(t.verticalLineX),a="M"+[[r,0],[r,t.chartHeight]].join("L"),i=t.panel.selectAll("path.vertical-line").data([0]);i.enter().append("path").attr({"class":"vertical-line shape"}),i.attr({d:a}),i.exit().remove();var n=t.panel.selectAll("text.vertical-line-label").data([0]);return n.enter().append("text").attr({"class":"vertical-line-label"}),n.attr({x:r+2,y:t.chartHeight+t.margin.top+t.margin.bottom/4}).text(t.verticalLineValue),i.exit().remove(),{}},piper.shapePanel=function(e){var t={panel:null};piper.utils.override(t,e);var r=t.panel.selectAll("g.shapes").data([0]);return r.enter().append("g").attr({"class":"shapes"}),r.exit().remove(),{shapePanel:r}},piper.areaShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var a=d3.svg.area().defined(function(e){return null!=e.y}).x(function(e){return t.scaleX(e.x)}).y(function(e){return t.scaleY(e.y)}).y0(t.scaleY.range()[0]),i=t.shapePanel.selectAll("path.line").data([t.dataConverted]);return i.enter().append("path").attr({"class":"line shape"}),i.attr({d:a}),i.exit().remove(),{}},piper.lineShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var a=d3.svg.line().defined(function(e){return null!=e.y}).x(function(e){return t.scaleX(e.x)}).y(function(e){return t.scaleY(e.y)}),i=t.shapePanel.selectAll("path.line").data([t.dataConverted]);return i.enter().append("path").attr({"class":"line shape"}).style({fill:"none"}),i.attr({d:a}),i.exit().remove(),{}},piper.barShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,chartHeight:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var a=t.scaleX.range(),i=a[1]-a[0],n=i/(t.dataConverted.length-1)/2,l=t.shapePanel.selectAll("rect.bar").data(t.dataConverted);return l.enter().append("rect").attr({"class":"bar shape"}),l.transition().attr({x:function(e){return t.scaleX(e.x)-n/2},y:function(e){var r=t.scaleY(e.y);return e.barY=e.y>0&&r===t.chartHeight?t.chartHeight-1:r,e.barY},width:function(e){return n},height:function(e){return t.chartHeight-e.barY}}),l.exit().remove(),{}},piper.barShapesGrouped=function(e){var t={panel:null,dataConverted:null,dataFlat:null,scaleX:null,scaleY:null,chartHeight:null,chartWidth:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var a=t.chartWidth/(t.dataFlat.length-1)/2,i=t.chartWidth/(t.dataConverted.length-1),n=t.shapePanel.selectAll("g.shape-group").data(t.dataConverted);n.enter().append("g").attr({"class":"shape-group"}),n.attr({transform:function(e,t){return"translate("+(i*t-i/4)+" 0)"}}),n.exit().remove();var l=n.selectAll("rect.bar").data(function(e){return console.log(e),e.y});return l.enter().append("rect").attr({"class":"bar shape"}),l.transition().attr({x:function(e,t){return a*t},y:function(e){var r=t.scaleY(e);return r=e&&e>0&&r===t.chartHeight?t.chartHeight-1:r},width:function(e){return a},height:function(e){var r=t.scaleY(e);return r=e&&e>0&&r===t.chartHeight?t.chartHeight-1:r,t.chartHeight-r}}),l.exit().remove(),{}},piper.endCircle=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,width:null,shapePanel:null};piper.utils.override(t,e);var r=piper.shapePanel(t);piper.utils.override(t,r);var a=t.dataConverted[t.dataConverted.length-1],i=t.shapePanel.selectAll("circle.end-circle").data([a]);return i.enter().append("circle").attr({"class":"end-circle shape"}),i.attr({cx:function(e){return t.scaleX(e.x)},cy:function(e){return t.scaleY(e.y)},r:2}),i.exit().remove(),{}},piper.eventCatchingLayer=function(e){var t={panel:null,chartWidth:null,chartHeight:null};piper.utils.override(t,e);var r=d3.dispatch("mousemove"),a=t.panel.selectAll("g.event-panel-container").data([0]);a.enter().append("g").attr({"class":"event-panel-container"}).append("rect").attr({"class":"event-panel"}),a.exit().remove();var i=a.select(".event-panel").attr({width:t.chartWidth,height:t.chartHeight}).style({visibility:"hidden","pointer-events":"all"});return{eventPanel:i,dispatch:r}},piper.events=function(e){var t={eventer:null,dispatch:null};return piper.utils.override(t,e),t.eventer&&d3.rebind(t.eventer,t.dispatch,"on"),{}},piper.tooltipComponent=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,eventPanel:null,chartWidth:null,chartHeight:null,dispatch:null,eventer:null};piper.utils.override(t,e);var r=piper.eventCatchingLayer(t);piper.utils.override(t,r),r=piper.events(t),piper.utils.override(t,r);var a=t.dataConverted.map(function(e){return e.x}),i=t.scaleX(a[1])-t.scaleX(a[0]),n=t.panel.selectAll("g.tooltip-container").data([0]);n.enter().append("g").attr({"class":"tooltip-container","pointer-events":"none"}).style({visibility:"hidden"}).append("circle").attr({"class":"tooltip-circle",r:3}),n.exit().remove();var l=t.panel.selectAll("g.value-container").data([0]);l.enter().append("g").attr({"class":"value-container","pointer-events":"none"}).style({visibility:"hidden"}).append("text").attr({"class":"value-label",dx:2,dy:-4}),l.exit().remove();var p=t.panel.selectAll("g.line-container").data([0]);p.enter().append("g").attr({"class":"line-container","pointer-events":"none"}).style({visibility:"hidden"}).append("line").attr({"class":"tooltip-line"}),p.exit().remove();var o=l.select(".value-label"),s=(n.select(".tooltip-circle"),p.select(".tooltip-line"));return t.eventPanel.on("mouseenter",function(e){n.style({visibility:"visible"}),l.style({visibility:"visible"}),s.style({visibility:"visible"})}).on("mouseout",function(e){n.style({visibility:"hidden"}),l.style({visibility:"hidden"}),s.style({visibility:"hidden"})}).on("mousemove",function(e,r){var p=d3.mouse(this),u=t.scaleX.invert(p[0]-i/2),c=d3.bisectLeft(a,u),d=t.dataConverted[c];if(d){var h=d.x,v=d.y,m=t.scaleX(h),x=t.scaleY(v);n.attr({transform:"translate("+[m,x]+")"}),l.attr({transform:"translate("+[0,x]+")"}),o.text(v),s.attr({x1:0,y1:x,x2:m,y2:x})}t.dispatch.mousemove(d)}),{}},piper.axisXFormatterTime=function(e){var t={panel:null,dataConverted:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").text(function(e){return d3.time.format("%a")(e)}),{}},piper.axisXFormatterTimeHour=function(e){var t={panel:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").text(function(e){return d3.time.format("%x")(e)}),{}},piper.axisXFormatterRotate30=function(e){var t={panel:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").style({transform:"rotate(30deg)","text-anchor":"start"}),{}},piper.areaChart=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.areaShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.chartTitleComponent,piper.tooltipComponent),piper.areaChartTime=piper.utils.pipeline(piper.dataTime,piper.scaleXTime,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.areaShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.axisXFormatterTimeHour,piper.tooltipComponent),piper.areaChartTimeRotated=piper.utils.pipeline(piper.dataTime,piper.scaleXTime,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.areaShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.chartTitleComponent,piper.axisXFormatterTimeHour,piper.axisXFormatterRotate30,piper.tooltipComponent),piper.areaChartFrom0=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleYFrom0Padded,piper.axisX,piper.axisY,piper.panelComponent,piper.areaShapes,piper.axisComponentY,piper.thresholdLine,piper.thresholdLineLabel,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.chartTitleComponent,piper.tooltipComponent),piper.lineChart=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.lineShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.tooltipComponent),piper.sparkline=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.panelComponent,piper.lineShapes,piper.endCircle,piper.tooltipComponent),piper.barChart=piper.utils.pipeline(piper.data,piper.barChartAutoConfig,piper.scaleX,piper.scaleYStartAt0,piper.axisX,piper.axisY,piper.panelComponent,piper.barShapes,piper.axisComponentY,piper.axisComponentX),piper.barChartPrumo=piper.utils.pipeline(piper.data,piper.barChartAutoConfig,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.barShapes,piper.axisComponentY,piper.thresholdLine,piper.thresholdLineLabel,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.chartTitleComponent,piper.tooltipComponent),piper.barChartGroupedPrumo=piper.utils.pipeline(piper.dataGrouped,piper.barChartAutoConfig,piper.scaleX,piper.scaleYGrouped,piper.axisX,piper.axisY,piper.panelComponent,piper.barShapesGrouped,piper.axisComponentX,piper.axisComponentY,piper.thresholdLine,piper.thresholdLineLabel,piper.axisTitleComponentY,piper.chartTitleComponent,piper.tooltipComponent),piper.singleAxis=piper.utils.pipeline(piper.data,piper.scaleX,piper.axisX,piper.panelComponent,piper.singleAxisComponentX),"object"==typeof module&&module.exports){var d3=require("d3");module.exports=piper}