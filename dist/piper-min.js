var piper={version:"0.1.0"};if(piper.utils={pipeline:function(){var e=arguments,t=this;return function(a){for(var r=0;r<e.length;r++){var n=e[r].call(this,a);a=t.mergeAll(a,n)}}},override:function(e,t){for(var a in t)a in e&&(e[a]=t[a])},merge:function(e,t){for(var a in t)t[a]&&t[a].constructor==Object&&e[a]?this.merge(e[a],t[a]):e[a]=t[a]},mergeAll:function(){for(var e={},t=arguments,a=0;a<t.length;a++)this.merge(e,t[a]);return e}},piper.barChartAutoConfig=function(e){return{axisYPadding:20}},piper.data=function(e){var t={data:null};piper.utils.override(t,e);var a=t.data.map(function(e,t){return{x:t,y:e}});return{dataConverted:a}},piper.scaleX=function(e){var t={dataConverted:null,margin:null,width:null,scaleType:null};piper.utils.override(t,e);var a=t.width-t.margin.left-t.margin.right,r=t.dataConverted.map(function(e){return e.x}),n=d3.scale.linear().domain(d3.extent(r)).range([0,a]);return{scaleX:n,chartWidth:a}},piper.scaleY=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var a=t.height-t.margin.top-t.margin.bottom,r=t.dataConverted.map(function(e){return e.y}),n=d3.scale.linear().domain(d3.extent(r)).range([a,0]);return{scaleY:n,chartHeight:a}},piper.scaleYStartAt0=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var a=t.height-t.margin.top-t.margin.bottom,r=t.dataConverted.map(function(e){return e.y}),n=d3.scale.linear().domain([0,d3.max(r)]).range([a,0]);return{scaleY:n,chartHeight:a}},piper.axisX=function(e){var t={scaleX:null,axisXFormat:"%H:%M",axisXTimeResolution:"minutes",axisXTimeSteps:2};piper.utils.override(t,e);var a=d3.svg.axis().scale(t.scaleX).orient("bottom");return{axisX:a}},piper.axisY=function(e){var t={scaleY:null,chartWidth:null,margin:null,axisYPadding:0};piper.utils.override(t,e);var a=d3.svg.axis().scale(t.scaleY).orient("left").ticks(6,"s").tickPadding(10);return{axisY:a}},piper.panelComponent=function(e){var t={container:null,width:null,height:null,margin:null};piper.utils.override(t,e);var a=d3.select(t.container).selectAll("svg").data([0]);a.enter().append("svg").attr({"class":"piper-chart"}).append("g").attr({"class":"panel"}),a.attr({width:t.width,height:t.height}),a.exit().remove();var r=a.select("g.panel").attr({transform:"translate("+t.margin.left+","+t.margin.top+")"});return{root:a,panel:r}},piper.axisComponentX=function(e){var t={axisX:null,chartHeight:null,panel:null};piper.utils.override(t,e);var a=t.panel.selectAll("g.axis.x").data([0]);return a.enter().append("g").attr({"class":"x axis",transform:"translate("+[0,t.chartHeight]+")"}),a.transition().attr({transform:"translate("+[0,t.chartHeight]+")"}).call(t.axisX),a.exit().remove(),{}},piper.singleAxisComponentX=function(e){var t={axisX:null,panel:null};piper.utils.override(t,e);var a=t.panel.selectAll("g.axis.x.single").data([0]);return a.enter().append("g").attr({"class":"x axis single"}),a.transition().call(t.axisX),a.exit().remove(),{}},piper.axisComponentY=function(e){var t={axisY:null,panel:null,axisYPadding:null};piper.utils.override(t,e);var a=t.axisYPadding||0,r=t.panel.selectAll("g.axis.y").data([0]);return r.enter().append("g").attr({"class":"y axis",transform:"translate("+[-a/2,0]+")"}),r.transition().call(t.axisY),r.exit().remove(),{}},piper.axisTitleComponentX=function(e){var t={panel:null,axisTitleX:null,chartHeight:null,chartWidth:null};piper.utils.override(t,e);var a=t.panel.selectAll("text.axis-title.x").data([0]);return a.enter().append("text").attr({"class":"x axis-title"}),a.text(t.axisTitleX||"").attr({x:t.chartWidth-40,y:t.chartHeight+40}),a.exit().remove(),{}},piper.axisTitleComponentY=function(e){var t={panel:null,axisTitleY:null};piper.utils.override(t,e);var a=t.panel.selectAll("text.axis-title.y").data([0]);return a.enter().append("text").attr({"class":"y axis-title"}),a.text(t.axisTitleY||"").attr({x:-40,y:-10}),a.exit().remove(),{}},piper.tresholdLine=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,margin:null,chartWidth:null,thresholdY:null};if(piper.utils.override(t,e),"number"!=typeof t.thresholdY)return{};var a=t.scaleY(t.thresholdY),r="M"+[[t.margin.left,a],[t.chartWidth,a]].join("L"),n=t.panel.selectAll("path.treshold").data([0]);return n.enter().append("path").attr({"class":"treshold shape"}).style({fill:"none"}),n.attr({d:r}),n.exit().remove(),{}},piper.verticalLine=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,chartHeight:null,margin:null,verticalLineX:null,verticalLineValue:null};piper.utils.override(t,e);var a=t.scaleX(t.verticalLineX),r="M"+[[a,0],[a,t.chartHeight]].join("L"),n=t.panel.selectAll("path.vertical-line").data([0]);n.enter().append("path").attr({"class":"vertical-line shape"}),n.attr({d:r}),n.exit().remove();var i=t.panel.selectAll("text.vertical-line-label").data([0]);return i.enter().append("text").attr({"class":"vertical-line-label"}),i.attr({x:a+2,y:t.chartHeight+t.margin.top+t.margin.bottom/4}).text(t.verticalLineValue),n.exit().remove(),{}},piper.shapePanel=function(e){var t={panel:null};piper.utils.override(t,e);var a=t.panel.selectAll("g.shapes").data([0]);return a.enter().append("g").attr({"class":"shapes"}),a.exit().remove(),{shapePanel:a}},piper.areaShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,shapePanel:null};piper.utils.override(t,e);var a=piper.shapePanel(t);piper.utils.override(t,a);var r=d3.svg.area().defined(function(e){return null!=e.y}).x(function(e){return t.scaleX(e.x)}).y(function(e){return t.scaleY(e.y)}).y0(t.scaleY.range()[0]),n=t.shapePanel.selectAll("path.line").data([t.dataConverted]);return n.enter().append("path").attr({"class":"line shape"}),n.attr({d:r}),n.exit().remove(),{}},piper.lineShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,shapePanel:null};piper.utils.override(t,e);var a=piper.shapePanel(t);piper.utils.override(t,a);var r=d3.svg.line().defined(function(e){return null!=e.y}).x(function(e){return t.scaleX(e.x)}).y(function(e){return t.scaleY(e.y)}),n=t.shapePanel.selectAll("path.line").data([t.dataConverted]);return n.enter().append("path").attr({"class":"line shape"}).style({fill:"none"}),n.attr({d:r}),n.exit().remove(),{}},piper.barShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,chartHeight:null,shapePanel:null};piper.utils.override(t,e);var a=piper.shapePanel(t);piper.utils.override(t,a);var r=t.scaleX.range(),n=r[1]-r[0],i=n/(t.dataConverted.length-1)/2,l=t.shapePanel.selectAll("rect.bar").data(t.dataConverted);return l.enter().append("rect").attr({"class":"bar shape"}),l.transition().attr({x:function(e){return t.scaleX(e.x)-i/2},y:function(e){return t.scaleY(e.y)},width:function(e){return i},height:function(e){return t.chartHeight-t.scaleY(e.y)}}),l.exit().remove(),{}},piper.endCircle=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,width:null,shapePanel:null};piper.utils.override(t,e);var a=piper.shapePanel(t);piper.utils.override(t,a);var r=t.dataConverted[t.dataConverted.length-1],n=t.shapePanel.selectAll("circle.end-circle").data([r]);return n.enter().append("circle").attr({"class":"end-circle shape"}),n.attr({cx:function(e){return t.scaleX(e.x)},cy:function(e){return t.scaleY(e.y)},r:2}),n.exit().remove(),{}},piper.eventCatchingLayer=function(e){var t={panel:null,chartWidth:null,chartHeight:null};piper.utils.override(t,e);var a=d3.dispatch("mousemove"),r=t.panel.selectAll("g.event-panel-container").data([0]);r.enter().append("g").attr({"class":"event-panel-container"}).append("rect").attr({"class":"event-panel"}),r.exit().remove();var n=r.select(".event-panel").attr({width:t.chartWidth,height:t.chartHeight}).style({visibility:"hidden","pointer-events":"all"});return{eventPanel:n,dispatch:a}},piper.events=function(e){var t={eventer:null,dispatch:null};return piper.utils.override(t,e),d3.rebind(t.eventer,t.dispatch,"on"),{}},piper.tooltipComponent=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,eventPanel:null,chartWidth:null,chartHeight:null,dispatch:null,eventer:null};piper.utils.override(t,e);var a=piper.eventCatchingLayer(t);piper.utils.override(t,a),a=piper.events(t),piper.utils.override(t,a);var r=t.dataConverted.map(function(e){return e.x}),n=t.scaleX(r[1])-t.scaleX(r[0]),i=t.panel.selectAll("g.tooltip-container").data([0]);i.enter().append("g").attr({"class":"tooltip-container","pointer-events":"none"}).style({visibility:"hidden"}).append("circle").attr({"class":"tooltip-circle",r:3}),i.exit().remove();var l=t.panel.selectAll("g.value-container").data([0]);l.enter().append("g").attr({"class":"value-container","pointer-events":"none"}).style({visibility:"hidden"}).append("text").attr({"class":"value-label",dy:-4}),l.exit().remove();var p=t.panel.selectAll("g.line-container").data([0]);p.enter().append("g").attr({"class":"line-container","pointer-events":"none"}).style({visibility:"hidden"}).append("line").attr({"class":"tooltip-line"}),p.exit().remove();var s=l.select(".value-label"),o=(i.select(".tooltip-circle"),p.select(".tooltip-line"));return t.eventPanel.on("mouseenter",function(e){i.style({visibility:"visible"}),l.style({visibility:"visible"}),o.style({visibility:"visible"})}).on("mouseout",function(e){i.style({visibility:"hidden"}),l.style({visibility:"hidden"}),o.style({visibility:"hidden"})}).on("mousemove",function(e){var a=d3.mouse(this),p=t.scaleX.invert(a[0]-n/2),u=d3.bisectLeft(r,p),c=t.dataConverted[u];if(c){var d=c.x,v=c.y,h=t.scaleX(d),x=t.scaleY(v);i.attr({transform:"translate("+[h,x]+")"}),l.attr({transform:"translate("+[0,x]+")"}),s.text(d3.round(v,1)),o.attr({x1:0,y1:x,x2:h,y2:x})}t.dispatch.mousemove(c)}),{}},piper.axisXFormatter=function(e){var t={panel:null,dataConverted:null};return piper.utils.override(t,e),t.panel.select("g.axis.x.single").selectAll(".tick:first-child text").text(function(e){return d3.time.format("%a")(e)}),{}},piper.areaChart=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.areaShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.tooltipComponent),piper.lineChart=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.lineShapes,piper.axisComponentX,piper.axisComponentY,piper.axisTitleComponentX,piper.axisTitleComponentY,piper.tooltipComponent),piper.sparkline=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.panelComponent,piper.lineShapes,piper.endCircle,piper.tooltipComponent),piper.barChart=piper.utils.pipeline(piper.data,piper.barChartAutoConfig,piper.scaleX,piper.scaleYStartAt0,piper.axisX,piper.axisY,piper.panelComponent,piper.barShapes,piper.axisComponentY,piper.axisComponentX),piper.singleAxis=piper.utils.pipeline(piper.data,piper.scaleX,piper.axisX,piper.panelComponent,piper.singleAxisComponentX),"object"==typeof module&&module.exports){var d3=require("d3");module.exports=piper}